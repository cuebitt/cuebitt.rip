---
import { Image } from "astro:assets";
import "@splidejs/splide/css";
import { Splide, SplideSlide } from "astro-splide";
import { parse, format } from "date-fns";

interface CarouselItem {
  img_src: string;
  img_alt: string;
  width: number;
  height: number;
  date: string;
  attribution_name: string;
  attribution_url: string;
  blur: boolean;
}

interface Props {
  items: CarouselItem[];
  class?: string;
}

const { items } = Astro.props;

const formatDate = (date: string) => {
  const _date = parse(date, "yyyy-MM", new Date());
  return format(_date, "LLL yy").split(" ").join(" '");
};
---

<div class="overflow-hidden bg-white not-content">
  <Splide options={{ type: "loop", heightRatio: 9 / 16 }}>
    {
      items.map((item, index) => (
        <SplideSlide class="flex flex-col">
          <figure class="relative my-0 max-h-full">
            <Image
              src={item.img_src}
              alt={item.img_alt}
              width={item.width}
              height={item.height}
              loading="lazy"
              class="!mx-auto my-0 w-fit max-h-full object-contain"
            />

            <figcaption class="text-(--sl-color-text-accent) absolute right-0 bottom-0 bg-slate-300 dark:bg-slate-700 px-2 py-0.5 rounded-tl-md hover:opacity-25 opacity-75 transition-opacity">
              <a
                href={item.attribution_url}
                target="_blank"
                rel="noopener noreferrer"
              >
                {item.attribution_name}, {formatDate(item.date)}
              </a>
            </figcaption>
          </figure>
        </SplideSlide>
      ))
    }
  </Splide>
</div>

<!-- hack to remove padding from a card -->
<style is:global>
  .no-pad .card {
    padding: 0 !important;
  }

  .no-pad .title {
    display: none;
  }
</style>
