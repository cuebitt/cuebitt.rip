---
import { Icon } from "astro-icon/components";
import Layout from "../../layouts/Layout.astro";
import WikiCard from "../../components/wiki-card.astro";
import Toc from "../../components/toc.astro";
import { frontmatter, Content, getHeadings } from "./art.mdx";

interface Props {
  title: string;
  subtitle: string;
  topic: string;
  imageSrc: string;
  imageAlt: string;
  details: {
    label: string;
    value: string;
  }[];
}

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

const { title, subtitle, topic, imageSrc, imageAlt, details } = frontmatter;

interface Detail {
  label: string;
  value: string;
}

const _details = Object.entries(details).map(([label, value]) => ({
  label,
  value,
})) as Detail[];

const openTempModal = import.meta.env.PROD;

const headings = getHeadings();
---

<Layout title={`${topic} - ${title}`}>
  <header class="container mx-auto py-5">
    <hgroup>
      <h1 class="text-4xl font-bold">{title}</h1>
      <h2 class="text-3xl">{subtitle}</h2>
    </hgroup>
  </header>
  <div
    class="container mx-auto grid gap-2"
    style="grid-template-columns: 1fr 3fr 1fr;"
    x-data="tocIntersect"
  >
    <aside class="sticky top-32 mt-10 h-fit">
      <Toc headings={headings} />
    </aside>
    <article class="prose">
      <Content />
    </article>
    <aside class="sticky top-5 mt-10 h-fit">
      <WikiCard
        topic={topic}
        imageSrc={imageSrc}
        imageAlt={imageAlt}
        details={_details}
      />
    </aside>
  </div>

  <footer></footer>

  <dialog
    id="temp-modal"
    class="fixed inset-0 rounded-md border-2 bg-white p-4 shadow-lg"
    open={openTempModal}
  >
    <form method="dialog" class="float-right">
      <input
        type="submit"
        value="x"
        class="size-9 rounded-md border-2 align-middle font-black shadow-sm transition hover:scale-110"
      />
    </form>

    <article class="prose">
      <h1>ðŸšœ Under Construction ðŸš§</h1>

      <p>
        This page is under construction! In the meantime, please see the <a
          href="https://cuebitt.neocities.org/art">old version</a
        >.
      </p>
    </article>
  </dialog>

  <hr class="container mx-auto" />
  <footer class="container mx-auto p-4">
    <nav class="mx-auto w-fit">
      <ul>
        <li class="flex flex-row space-x-2 align-middle">
          <Icon name="fa6-brands:github" class="my-auto" />
          <a
            href="http://github.com/cuebitt/cuebitt.rip"
            target="_blank"
            rel="noopener noreferrer"
          >
            Source Code
          </a>
        </li>
      </ul>
    </nav>
  </footer>
</Layout>
